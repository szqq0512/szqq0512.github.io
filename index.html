<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é’é’å°ç«¹ç½‘ | æ—…æ¸¸ç™¾ç§‘ | å„åœ°æ™¯ç‚¹</title>
    <script src="https://demo.likeyunba.com/md-marked/marked.min.js"></script>
    <style>
        :root {
            --primary: #6c5ce7;
            --light: #f7f7ff;
            --border: #e0e0e0;
            --text: #3d3d3d;
            --radius: 12px;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #f9f9f9;
            color: var(--text);
            overflow: hidden;
        }
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            width: 99%;
            max-width: 2200px;
            margin: 10px auto;
            gap: 15px;
        }
        .sidebar {
            width: 260px;
            background: #fff;
            border-radius: var(--radius);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
        }
        .sidebar-header {
            padding: 10px 12px;
            background: var(--primary);
            border-radius: var(--radius) var(--radius) 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }
        .sidebar-header h2 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        .sidebar-header a {
            color: white;
            text-decoration: none;
        }
        .sidebar-header .toggle-btn { 
            display: none; 
        }
        .search-bar {
            display: flex;
            align-items: center;
            background: #fff;
            border-radius: var(--radius);
            padding: 2px 8px;
            gap: 6px;
            min-width: 0;
            height: 36px;
            margin: 0 10px 10px;
            position: relative; 
            border: 1px solid var(--border);
        }
        .search-bar input {
            border: none;
            outline: none;
            background: transparent;
            flex: 1;
            font-size: 1em;
            padding: 4px 0;
            min-width: 0;
            height: 28px;
            line-height: 28px;
            padding-right: 30px; 
        }
        .search-type {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0 10px;
            background: #f5f5fa;
            font-size: 1em;
            color: #6c5ce7;
            user-select: none;
            position: relative;
            height: 28px;
            min-width: 70px;
            line-height: 28px;
        }
        .search-type .dropdown-arrow { margin-left: 2px; font-size: 0.9em; }
        .search-type-dropdown {
            position: absolute;
            top: 110%;
            left: 0;
            background: #fff;
            min-width: 70px;
            z-index: 10;
            font-size: 1em;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        .search-type-dropdown div {
            padding: 2px 16px;
            cursor: pointer;
            color: #6c5ce7;
            background: #fff;
        }
        .search-type-dropdown div:hover { background: #e0ebff; }
        #search-clear {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.3em;
            cursor: pointer;
            color: #6c5ce7;
            user-select: none;
            z-index: 2;
            width: 1.5em;
            height: 1.5em;
            line-height: 1.5em;
            text-align: center;
        }
        #search-clear:hover {
            color: #fdcb6e;
            background: #f5f6fa;
            border-radius: 50%;
        }
        .tree-view {
            flex: 1;
            overflow-y: auto;
            background: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            min-height: 100px;
        }
        .folder, .file, .heading-item {
            padding: 6px 10px 6px 1em;
            margin: 2px 5px;
            border-radius: var(--radius);
            cursor: pointer;
            position: relative;
            display: flex;
            align-items: center;
            min-height: 28px;
            white-space: nowrap;
            overflow: hidden;
            background: var(--light);
        }
        .heading-item { padding-left: 2em; }
        .folder:hover, .file:hover, .heading-item:hover { 
            background: #e0ebff; 
        }
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f9f9f9;
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid var(--border);
        }
        .markdown-container {
            flex: 1;
            overflow-y: auto;
            padding: 2em;
            background: #fff;
            padding-bottom: max(2em, 12vh);
        }
        .markdown-content {
            line-height: 1.7;
            color: var(--text);
            font-size: 1.05rem;
            text-align: left;
        }
        .markdown-content > p { margin-top: 1em; }
        .markdown-content a { text-decoration: none; color: var(--primary); }
        .markdown-content a:hover { color: #00cec9; }

        /* åˆå¹¶æ ‡é¢˜å…¬å…±æ ·å¼ */
        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3 {
            padding-bottom: 4px !important;
            border-bottom: 1px solid #e0e0e0 !important;
        }
        .markdown-content h1 {
            color: #6c5ce7 !important;
            font-size: 2rem !important;
        }
        .markdown-content h2 {
            color: #00cec9 !important;
            font-size: 1.7rem !important;
            margin: 25px 0 15px !important;
        }
        .markdown-content h3 {
            color: #fd79a8 !important;
            font-size: 1.4rem !important;
            margin: 25px 0 15px !important;
        }

        .markdown-content ul { list-style: none; margin: 20px 0; }
        .markdown-content ul > li {
            position: relative;
            padding: 0.25em 0.5em;
            text-indent: -0.5em;
        }
        .markdown-content ul > li:nth-child(odd) { background-color: #f0f5ff; }
        .markdown-content blockquote {
            text-indent: 0em;
            font-size: 0.92em;
            font-style: italic;
            color: #008080;
            margin-left: 1em;
            border-left: 0.12em solid #008080;
            padding: 0 0.6em;
        }
        .markdown-content em { color: #346c91; font-style: normal; }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #b0b0b0;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

.markdown-content img,
.welcome-image,
.markdown-content table {
    max-width: min(99%, 1400px);
    height: auto;
    display: block;
    margin: 10px auto;
    border-collapse: collapse;
}

        .children { display: none; }
        .folder.expanded + .children { display: block; }
        .tree-view .children {
            margin-left: 1em;
        }
        .tree-view .children .folder,
        .tree-view .children .file {
            margin-left: inherit;
        }

        @media (max-width: 992px) {
            .container { width: 100%; flex-direction: column; padding: 0; margin: 0; gap: 0; }
            .sidebar { width: 100%; border-radius: 0; max-height: 50vh; border-bottom: 1px solid var(--border); }
            .sidebar.collapsed .search-bar,
            .sidebar.collapsed .search-no-result,
            .sidebar.collapsed .tree-view { 
                display: none; 
            } 
            .sidebar.collapsed { overflow: hidden; max-height: 60px; }
            .sidebar-header .toggle-btn { 
                display: block;
            }
            .content { border-radius: 0; }
            .markdown-container { padding: 0.8em; padding-bottom: 18vh !important; }
        }
        .toggle-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 10px;
        }
        .toggle-btn .emoji-icon { font-size: 1.6em; color: #fff; }
        .search-hit {
            background: #ffe066 !important;
            color: #d35400 !important;
            border-radius: 4px;
            padding: 0 2px;
        }
        .tree-view .search-hit {
            font-weight: bold;
        }
        .search-no-result {
            display: none;
            text-align: left;
            color: #b36b00;
            background: #fffbe6;
            margin: 0 10px 10px;
            padding: 7px 14px;
            font-size: 1em;
            border: 1px solid #ffe066;
            min-height: 1.5em;
            line-height: 1.5em;
            font-weight: 500;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }


        
        /* åŒIDæ˜¾ç¤ºæ§åˆ¶ */
        .node-view {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .highlight-view {
            display: none;
        }
        .search-mode .normal-view {
            display: none;
        }
        .search-mode .highlight-view {
            display: flex !important;
        }

        .markdown-content th, 
        .markdown-content td {
            padding: 0.75em 1em;
            text-align: left;
            border: 1px solid #e0e0e0;
        }
        
        .markdown-content th {
            background-color: #f5f7fa;
            font-weight: 600;
            color: var(--primary);
        }
        
        .markdown-content tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* åŠ è½½æŒ‡ç¤ºå™¨ */
        .search-loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header" id="sidebar-header">
                <h2 id="home-link">
                    <a href="#">
                        <span class="emoji-icon" aria-hidden="true">ğŸ“–</span>
                        <span>é’é’å°ç«¹ç½‘</span>
                    </a>
                </h2>
                <button class="toggle-btn" id="toggle-sidebar" data-collapsed="false">
                    <span class="emoji-icon" aria-hidden="true">â–½</span>
                    <span class="sr-only">æŠ˜å /å±•å¼€</span>
                </button>
            </div>
            
            <div class="search-bar" id="search-bar">
                <div class="search-type" id="search-type" tabindex="0">
                    <span id="search-type-label">èœå•</span>
                    <span class="dropdown-arrow">â–¼</span>
                    <div class="search-type-dropdown" id="search-type-dropdown" style="display:none;">
                        <div data-type="menu">èœå•</div>
                        <div data-type="content">å†…å®¹</div>
                    </div>
                </div>
                <input id="search-input" type="text" placeholder="æœç´¢èœå•æ–‡æ¡£..." />
                <span id="search-clear">â•³</span>
            </div>
            <div id="search-no-result" class="search-no-result" style="display:none;">æ— æ­¤æœç´¢é¡¹</div>
            
            <div class="tree-view" id="tree-view"></div>
        </aside>
        
        <main class="content" id="content">
            <div class="empty-state" id="welcome-content">
                <h2>æ¬¢è¿ä½¿ç”¨é’é’å°ç«¹ç½‘</h2>
                <br>
                <p>ä¸€ä¸ªç®€å•çš„ä½¿ç”¨Markdownè¯­æ³•çš„ä¸ªäººç¬”è®°ã€‚</p>  
                <br>
                <p>ä»ç½‘ä¸Šæœé›†æ•´ç†çš„æ—…æ¸¸ç›¸å…³èµ„æ–™ï¼Œä¸»è¦ç½—åˆ—äº†ä¸­å›½å„åœ°çš„æ¦‚å†µã€æ™¯ç‚¹åŠç‰¹è‰²æ‘å¯¨ç­‰ï¼Œæ–¹ä¾¿æŸ¥æ‰¾å’Œå‡ºè¡Œè§„åˆ’ã€‚</p>
                <br>
                <p>è¯·é€‰æ‹©è¦æŸ¥çœ‹çš„æ–‡ä»¶</p>
                <br>
                <img src="https://s1.imagehub.cc/images/2025/06/13/bf3432b185d01be77f7f9f78f3a79dd7.webp" 
                     alt="æ¬¢è¿ä½¿ç”¨é’é’å°ç«¹ç½‘"
                     class="welcome-image" 
                     loading="lazy">
                <br>
                <p>å…è´£å£°æ˜</p>
                <p>æœ¬ç½‘ç«™ï¼ˆä»“åº“ï¼‰çš„æ‰€æœ‰å†…å®¹ä»…ä¾›ä¸ªäººå‚è€ƒä¹‹ç”¨ï¼Œç¦æ­¢ç”¨äºå•†ä¸šç”¨é€”ã€‚</p>
                <p>ä»»ä½•äººæˆ–ç»„ç»‡ä¸å¾—å°†æœ¬ç½‘ç«™ï¼ˆä»“åº“ï¼‰çš„å†…å®¹ç”¨äºéæ³•ç”¨é€”æˆ–ä¾µçŠ¯ä»–äººåˆæ³•æƒç›Šï¼Œä¸å¾—ç”¨äºåœ¨å…¶ä»–å¹³å°è¿›è¡Œä¼ æ’­ã€‚</p>
                <p>å¯¹äºå› ä½¿ç”¨æœ¬ç½‘ç«™ï¼ˆä»“åº“ï¼‰å†…å®¹è€Œå¼•èµ·çš„ä»»ä½•æ³•å¾‹è´£ä»»ï¼Œæœ¬ç½‘ç«™ï¼ˆä»“åº“ï¼‰ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚</p>
                <p>ä½¿ç”¨æœ¬ç½‘ç«™ï¼ˆä»“åº“ï¼‰çš„å†…å®¹å³è¡¨ç¤ºæ‚¨åŒæ„æœ¬å…è´£å£°æ˜çš„æ‰€æœ‰æ¡æ¬¾å’Œæ¡ä»¶ã€‚</p>
            </div>
        </main>
    </div>
    
    <div class="search-loading" id="search-loading">æœç´¢ä¸­...</div>

    <script>
        (() => {
            // ç§»åŠ¨ç«¯æœç´¢æ—¶è‡ªåŠ¨å±•å¼€ä¾§è¾¹æ 
            function expandSidebarIfNeeded() {
                if (window.innerWidth <= 992 && $.sidebar.classList.contains('collapsed')) {
                    $.sidebar.classList.remove('collapsed');
                    const icon = $.toggleSidebar.querySelector('.emoji-icon');
                    if (icon) icon.textContent = 'â–½';
                    $.toggleSidebar.setAttribute('data-collapsed', false);
                }
            }
            // ä¾§è¾¹æ æŠ˜å /å±•å¼€åˆ‡æ¢å‡½æ•°
            function toggleSidebar() {
                const collapsed = $.sidebar.classList.toggle('collapsed');
                const icon = $.toggleSidebar.querySelector('.emoji-icon');
                if (icon) icon.textContent = collapsed ? 'â–·' : 'â–½';
                $.toggleSidebar.setAttribute('data-collapsed', collapsed);
            }
            // DOM å¿«æ·é€‰æ‹©å™¨å¯¹è±¡
            const $ = {
                sidebar: document.getElementById('sidebar'),
                homeLink: document.getElementById('home-link'),
                toggleSidebar: document.getElementById('toggle-sidebar'),
                searchType: document.getElementById('search-type'),
                searchTypeLabel: document.getElementById('search-type-label'),
                searchTypeDropdown: document.getElementById('search-type-dropdown'),
                searchInput: document.getElementById('search-input'),
                searchClear: document.getElementById('search-clear'),
                searchNoResult: document.getElementById('search-no-result'),
                treeView: document.getElementById('tree-view'),
                content: document.getElementById('content'),
                welcomeContent: document.getElementById('welcome-content'),
                searchLoading: document.getElementById('search-loading'),
            };

            // å¼‚æ­¥åŠ è½½vx.json
            async function loadVxJson(path) {
                try {
                    let r = await fetch(path ? `æ—…æ¸¸/${path}/vx.json` : 'æ—…æ¸¸/vx.json');
                    // éªŒè¯æ˜¯å¦ä¸ºJSON
                    const contentType = r.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        return {folders:[],files:[]};
                    }
                    let d = await r.json();
                    cache.dirCache[path] = d; 
                    return d;
                } catch (error) {
                    return {folders:[],files:[]};
                }
            }
            // çŠ¶æ€
            const cache = {
                dirCache: {},
                mdContent: {},
                headings: {},
                currentFile: null,
                initialContentHTML: '',
                hasSearchResult: false,
                searchCanceled: false,
                pathMap: new Map(),
                isComposing: false,
                searchMatches: [],
                currentSearch: {
                    keyword: '',
                    type: 'menu',
                    lastKeyword: '',
                    lastType: ''
                },
                originalContent: null,
                firstHitElement: null
            };
            let fullTree = null;
            // å·¥å…·
            const utils = {
                cleanPath: (p) => {
                    if (!p) return '';
                    p = p.replace(/\\/g, '/').replace(/\/\//g, '/').trim();
                    if (p === '/') return '';
                    return p;
                },
                joinPath: (parentPath, childName) => {
                    if (!parentPath) return childName;
                    return `${parentPath.replace(/\/$/, '')}/${childName}`;
                },
                escapeRegExp: (string) => string.replace(/[.*+?^${}()|[\\]\\]/g, '\\$&'),
                highlightText: (text, keyword) => {
                    if (!keyword) return text;
                    const reg = new RegExp(utils.escapeRegExp(keyword), 'gi');
                    return text.replace(reg, match => `<span class="search-hit">${match}</span>`);
                },
                safeSanitize: (html) => {
                    if (!html) return '';
                    const temp = document.createElement('div');
                    temp.innerHTML = html;
                    const elements = temp.querySelectorAll('*');
                    for (const el of elements) {
                        const tagName = el.tagName.toLowerCase();
                        if ([
                            'script', 'iframe', 'object', 'embed', 'link'
                        ].includes(tagName)) {
                            el.remove();
                            continue;
                        }
                        const attrs = el.attributes;
                        for (let i = attrs.length - 1; i >= 0; i--) {
                            const attr = attrs[i];
                            const name = attr.name.toLowerCase();
                            if (name.startsWith('on') || 
                                (name === 'href' && /^(javascript|data):/i.test(attr.value)) ||
                                (name === 'src' && /^(javascript|data):/i.test(attr.value))) {
                                el.removeAttribute(name);
                            }
                        }
                    }
                    return temp.innerHTML;
                },
                scrollToElement: (element) => {
                    if (!element) return;
                    const container = document.querySelector('.markdown-container');
                    if (!container) return;
                    setTimeout(() => {
                        const containerRect = container.getBoundingClientRect();
                        const elementRect = element.getBoundingClientRect();
                        const scrollTop = container.scrollTop;
                        const offset = elementRect.top - containerRect.top + scrollTop - 100;
                        container.scrollTo({
                            top: offset,
                            behavior: 'smooth'
                        });
                    }, 50);
                }
            };
            
            // åˆ›å»ºèŠ‚ç‚¹å…ƒç´  - ç»Ÿä¸€ä½¿ç”¨ğŸ“å›¾æ ‡
            function createNodeElem(isFolder, f, p) {
                const c = document.createElement('div');
                const e = document.createElement('div');
                e.className = isFolder ? 'folder' : 'file';
                
                // ç»Ÿä¸€ä½¿ç”¨ğŸ“ä½œä¸ºæ–‡ä»¶å¤¹å›¾æ ‡
                const icon = isFolder ? 'ğŸ“' : 'ğŸ“„';
                
                // æ­£ç¡®è®¡ç®—æ–‡ä»¶å
                let name;
                if (isFolder) {
                    name = f.name;
                } else {
                    name = f.name.endsWith('.md') ? f.name.slice(0, -3) : f.name;
                }
                
                // ä¿®å¤æ¨¡æ¿å­—ç¬¦ä¸²è¯­æ³•
                e.innerHTML = `
                    <div class="node-view normal-view">
                        <span class="emoji-icon" aria-hidden="true">${icon}</span>${name}
                    </div>
                    <div class="node-view highlight-view" style="display:none">
                        <span class="emoji-icon" aria-hidden="true">${icon}</span>${name}
                    </div>
                `;
                
                e.dataset.path = utils.joinPath(p, f.name);
                e.title = name;
                
                const ch = document.createElement('div');
                ch.className = 'children';
                ch.style.display = 'none';
                
                c.appendChild(e);
                c.appendChild(ch);
                return c;
            }
            
            async function fetchMd(filePath) {
                const full = utils.joinPath('æ—…æ¸¸', filePath);
                if (cache.mdContent[full]) return cache.mdContent[full];
                try {
                    const r = await fetch(full);
                    if (!r.ok) return '';
                    const t = await r.text();
                    cache.mdContent[full] = t;
                    return t;
                } catch {
                    return '';
                }
            }
            
            function parseHeadings(md) {
                if (cache.headings[md]) return cache.headings[md];
                const h = [];
                window.marked.lexer(md).forEach(tok => {
                    if (tok.type === 'heading' && tok.depth <= 3) h.push({ level: tok.depth, text: tok.text });
                });
                cache.headings[md] = h;
                return h;
            }
 
            // é¢„å¤„ç†Markdownæ–‡æœ¬ - ç§»é™¤å›¾ç‰‡é“¾æ¥ä¸­çš„å°ºå¯¸å‚æ•°
            const preprocessMd = md => md.replace(/!\[(.*?)\]\((.*?)\s*=\s*\d+x\d*\s*\)/g, '![$1]($2)');
            
            // Markdownæ¸²æŸ“å‡½æ•°
            async function showMd(filePath, headingsContainer) {
                await checkMarkedLoaded();
                let md = await fetchMd(filePath);
                
                // é¢„å¤„ç†Markdownæ–‡æœ¬
                md = preprocessMd(md);
                
                let h = parseHeadings(md);
                let cont = document.createElement('div'); 
                cont.className = 'markdown-container';
                let area = document.createElement('div'); 
                area.className = 'markdown-content';
                let renderer = new window.marked.Renderer();
                let hid = 0;
                
                renderer.heading = function(token) {
                    const level = token.depth;
                    return `<h${level} id="heading-${level}-${hid++}">${token.text}</h${level}>`;
                };
                
                // ç”ŸæˆMarkdownå†…å®¹
                let htmlContent = window.marked.parse(md, {
                    renderer,
                    sanitize: true,
                    breaks: false,
                    gfm: true,
                    tables: true
                });
                
                // åº”ç”¨å®‰å…¨è¿‡æ»¤
                area.innerHTML = utils.safeSanitize(htmlContent);
                
                // ä¿å­˜åŸå§‹å†…å®¹
                cache.originalContent = area.cloneNode(true);
                cache.firstHitElement = null;
                
                cont.appendChild(area);
                genHeadingsTree(h, headingsContainer);
                $.content.innerHTML = ''; 
                $.content.appendChild(cont);
                
                // å¦‚æœå½“å‰æœ‰å†…å®¹æœç´¢ï¼Œåœ¨æ–°æ–‡æ¡£ä¸­æ‰§è¡Œæœç´¢
                if (cache.currentSearch.type === 'content' && cache.currentSearch.keyword) {
                    const found = await searchContent(cache.currentSearch.keyword);
                    
                    // å¦‚æœæ²¡æœ‰åŒ¹é…é¡¹ï¼Œæ˜¾ç¤ºæç¤º
                    if (!found) {
                        $.searchNoResult.style.display = 'block';
                        $.searchNoResult.textContent = 'æ— æ­¤æœç´¢é¡¹';
                    } else {
                        $.searchNoResult.style.display = 'none';
                    }
                }
                
                return cont;
            }
            
function genHeadingsTree(h, c) {
    if (!c) return;
    c.innerHTML = '';
    c.style.display = 'block';
    h.forEach(he => {
        const hi = document.createElement('div');
        hi.className = `heading-item h${he.level}`;
        const icon = he.level === 1 ? 'â€ºÂ ' : he.level === 2 ? 'Â Â»Â ' : he.level === 3 ? 'Â Â Â»â€ºÂ ' : '';
        hi.innerHTML = `<span class="emoji-icon" aria-hidden="true">${icon}</span><span>${he.text}</span>`;
        hi.onclick = e => {
            e.stopPropagation();
            scrollToHeading(he.text, he.level);
        };
        c.appendChild(hi);
    });
    function scrollToHeading(text, level) {
        let hs = document.querySelectorAll(`h${level}`);
        let t = Array.from(hs).find(h => h.textContent === text);
        if (t) {
            let container = document.querySelector('.markdown-container');
            let cr = container.getBoundingClientRect();
            let tr = t.getBoundingClientRect();
            let st = container.scrollTop;
            let off = tr.top - cr.top + st - 12;
            container.scrollTo({ top: off, behavior: 'smooth' });
        }
    }
}
            
            // ç¡®ä¿marked.jsåŠ è½½å®Œæˆ
            async function checkMarkedLoaded() {
                if (window.marked) return;
                
                return new Promise((resolve) => {
                    const maxWaitTime = 3000;
                    const startTime = Date.now();
                    
                    const interval = setInterval(() => {
                        if (window.marked) {
                            clearInterval(interval);
                            resolve();
                        } else if (Date.now() - startTime > maxWaitTime) {
                            clearInterval(interval);
                            resolve();
                        }
                    }, 100);
                });
            }
            
            // æ„å»ºå…¨é‡æ ‘
            async function buildFullTree() {
                async function walk(path) {
                    const data = await loadVxJson(path);
                    let node = {
                        name: path.split('/').pop()||'æ ¹ç›®å½•', 
                        path, 
                        type:'folder', 
                        children:[],
                        expanded: false
                    };
                    
                    // æ·»åŠ åˆ°è·¯å¾„æ˜ å°„
                    cache.pathMap.set(path, node);
                    
                    (data.folders||[]).forEach(f=>{
                        const childPath = path ? `${path}/${f.name}` : f.name;
                        node.children.push(walk(childPath));
                    });
                    
                    (data.files||[]).forEach(f=>{
                        const filePath = path ? `${path}/${f.name}` : f.name;
                        const fileNode = {
                            name: f.name, 
                            path: filePath, 
                        };
                        node.children.push(Promise.resolve(fileNode));
                        cache.pathMap.set(filePath, fileNode);
                    });
                    
                    node.children = await Promise.all(node.children);
                    return node;
                }
                fullTree = await walk('');
            }
            
            // æ¸²æŸ“æ ‘
            function renderTree(tree) {
                $.treeView.innerHTML = '';
                
                function createNode(node) {
                    let el;
                    
                    if (node.type === 'folder') {
                        el = document.createElement('div');
                        let folder = document.createElement('div');
                        folder.className = 'folder';
                        
                        // ç»Ÿä¸€ä½¿ç”¨ğŸ“å›¾æ ‡
                        const folderIcon = 'ğŸ“';
                        folder.innerHTML = `
                            <div class="node-view normal-view">
                                <span class="emoji-icon" aria-hidden="true">${folderIcon}</span>${node.name}
                            </div>
                            <div class="node-view highlight-view" style="display:none">
                                <span class="emoji-icon" aria-hidden="true">${folderIcon}</span>${node.name}
                            </div>
                        `;
                        
                        folder.dataset.path = node.path;
                        folder.title = node.name;
                        
                        let children = document.createElement('div');
                        children.className = 'children';
                        children.style.display = node.expanded ? 'block' : 'none';
                        
                        if (node.children && node.children.length) {
                            node.children.forEach(child => {
                                const childResult = createNode(child);
                                if (childResult) children.appendChild(childResult);
                            });
                        }
                        
                        el.appendChild(folder);
                        el.appendChild(children);
                    } else {
                        el = document.createElement('div');
                        let file = document.createElement('div');
                        file.className = 'file';
                        
                        let n = node.name.endsWith('.md') ? node.name.slice(0, -3) : node.name;
                        file.innerHTML = `
                            <div class="node-view normal-view">
                                <span class="emoji-icon" aria-hidden="true">ğŸ“„</span>${n}
                            </div>
                            <div class="node-view highlight-view" style="display:none">
                                <span class="emoji-icon" aria-hidden="true">ğŸ“„</span>${n}
                            </div>
                        `;
                        
                        file.dataset.path = node.path;
                        file.title = n;
                        
                        let children = document.createElement('div');
                        children.className = 'children';
                        children.style.display = 'none';
                        el.appendChild(file);
                        el.appendChild(children);
                    }
                    return el;
                }
                
                let root = tree;
                (root.children || []).forEach(child => {
                    const result = createNode(child);
                    if (result) $.treeView.appendChild(result);
                });
            }
            
            // æœç´¢é«˜äº®åŠŸèƒ½
            const applySearchHighlight = keyword => {
                if (!keyword) return;
                const lowerKeyword = keyword.toLowerCase();
                cache.searchMatches = [];
                collapseAllFolders();
                $.treeView.querySelectorAll('.folder, .file').forEach(node => {
                    const name = node.dataset.path.split('/').pop().replace('.md', '');
                    if (name.toLowerCase().includes(lowerKeyword)) {
                        // é«˜äº®
                        const highlightView = node.querySelector('.highlight-view');
                        if (highlightView) {
                            const icon = node.querySelector('.emoji-icon').textContent;
                            highlightView.innerHTML = `<span class="emoji-icon" aria-hidden="true">${icon}</span>${utils.highlightText(name, keyword)}`;
                        }
                        node.classList.add('search-hit');
                        cache.searchMatches.push({ element: node, isFile: node.classList.contains('file') });
                        expandParentContainers(node);
                    } else {
                        node.classList.remove('search-hit');
                    }
                });
                const foundMatch = cache.searchMatches.length > 0;
                $.searchNoResult.style.display = foundMatch ? 'none' : 'block';
                cache.hasSearchResult = foundMatch;
                if (foundMatch) setTimeout(() => cache.searchMatches[0].element.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
                if (cache.searchMatches.length === 1 && cache.searchMatches[0].isFile) setTimeout(() => cache.searchMatches[0].element.click(), 200);
            };
            
            // å±•å¼€åŒ¹é…èŠ‚ç‚¹çš„çˆ¶çº§å®¹å™¨
            function expandParentContainers(node) {
                let parent = node.closest('.children');
                while (parent) {
                    const folder = parent.previousElementSibling;
                    if (folder && folder.classList.contains('folder')) {
                        folder.classList.add('expanded');
                        parent.style.display = 'block';
                    }
                    parent = parent.parentElement.closest('.children');
                }
            }
            
            // å†…å®¹æœç´¢é«˜äº®å‡½æ•°ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰
            async function searchContent(keyword) {
                // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
                $.searchLoading.style.display = 'block';
                
                // é‡ç½®æœç´¢çŠ¶æ€
                cache.searchCanceled = false;
                cache.firstHitElement = null;
                
                // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
                clearHighlights();
                
                if (!keyword) {
                    $.searchLoading.style.display = 'none';
                    return false;
                }

                const area = document.querySelector('.markdown-content');
                if (!area) {
                    $.searchLoading.style.display = 'none';
                    return false;
                }
                
                // å®‰å…¨è¿‡æ»¤å…³é”®è¯
                keyword = keyword.replace(/[<>"'`]/g, '');
                
                // æ¢å¤åŸå§‹å†…å®¹
                if (cache.originalContent) {
                    area.innerHTML = cache.originalContent.innerHTML;
                }
                
                const escapedKeyword = utils.escapeRegExp(keyword);
                const reg = new RegExp(escapedKeyword, 'gi');
                
                // è·å–æ‰€æœ‰æ–‡æœ¬èŠ‚ç‚¹
                const textNodes = [];
                const walker = document.createTreeWalker(area, NodeFilter.SHOW_TEXT);
                while (walker.nextNode()) {
                    textNodes.push(walker.currentNode);
                }
                
                let foundMatch = false;
                let firstHit = null;
                
                // åˆ†æ‰¹å¤„ç†æ–‡æœ¬èŠ‚ç‚¹
                const batchSize = 50;
                let batchIndex = 0;
                
                // åˆ†æ‰¹å¤„ç†å‡½æ•°
                const processBatch = () => {
                    if (cache.searchCanceled) {
                        $.searchLoading.style.display = 'none';
                        return;
                    }
                    
                    const batch = textNodes.slice(batchIndex, batchIndex + batchSize);
                    batchIndex += batchSize;
                    
                    for (const node of batch) {
                        if (cache.searchCanceled) break;
                        
                        const text = node.nodeValue;
                        let match;
                        let lastIndex = 0;
                        let newContent = '';
                        let hasMatchInNode = false;
                        
                        while ((match = reg.exec(text)) !== null) {
                            foundMatch = true;
                            hasMatchInNode = true;
                            
                            // è®°å½•ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹
                            if (!firstHit) {
                                firstHit = match;
                            }
                            
                            newContent += text.substring(lastIndex, match.index);
                            newContent += `<span class="search-hit">${match[0]}</span>`;
                            
                            lastIndex = match.index + match[0].length;
                        }
                        
                        newContent += text.substring(lastIndex);
                        
                        if (hasMatchInNode) {
                            const tempDiv = document.createElement('div');
                            tempDiv.innerHTML = newContent;
                            
                            const parent = node.parentNode;
                            while (tempDiv.firstChild) {
                                parent.insertBefore(tempDiv.firstChild, node);
                            }
                            parent.removeChild(node);
                        }
                    }
                    
                    // å¦‚æœè¿˜æœ‰æ›´å¤šèŠ‚ç‚¹ï¼Œå¤„ç†ä¸‹ä¸€æ‰¹
                    if (batchIndex < textNodes.length) {
                        setTimeout(processBatch, 10); // æ·»åŠ å»¶è¿Ÿé¿å…é˜»å¡UI
                    } else {
                        // å¤„ç†å®Œæˆ
                        $.searchLoading.style.display = 'none';
                        
                        // æ»šåŠ¨åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹
                        if (firstHit) {
                            setTimeout(() => {
                                const firstHitElement = area.querySelector('.search-hit');
                                if (firstHitElement) {
                                    utils.scrollToElement(firstHitElement);
                                }
                            }, 100);
                        }
                    }
                };
                
                // å¼€å§‹å¤„ç†ç¬¬ä¸€æ‰¹
                processBatch();
                
                return new Promise(resolve => {
                    // è®¾ç½®è¶…æ—¶ä»¥ç¡®ä¿æœ€ç»ˆè§£æ
                    setTimeout(() => {
                        resolve(foundMatch);
                    }, 1000);
                });
            }
            
            // é˜²æŠ–å‡½æ•°
            function debounce(func, wait) {
                let timeout;
                return function(...args) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), wait);
                };
            }
            
            // æ¸…ç©ºæœç´¢æ¡†
            function clearSearch() {
                cache.searchCanceled = true;
                
                $.searchInput.value = '';
                $.searchClear.style.visibility = 'hidden';
                clearHighlights();
                cache.hasSearchResult = false;
                cache.currentSearch.keyword = '';
                cache.searchMatches = [];
                $.searchNoResult.style.display = 'none';
                
                // é‡ç½®æœ€åæœç´¢è®°å½•
                cache.currentSearch.lastKeyword = '';
                cache.currentSearch.lastType = '';
                
                if (window.innerWidth <= 992) {
                    $.searchInput.blur();
                }
            }
            
            // æŠ˜å æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶å¤¹
            function collapseAllFolders() {
                document.querySelectorAll('.folder.expanded').forEach(folder => {
                    folder.classList.remove('expanded');
                    const childrenContainer = folder.parentElement.querySelector('.children');
                    if (childrenContainer) {
                        childrenContainer.style.display = 'none';
                    }
                });
                
                document.querySelectorAll('.file,.folder').forEach(el => el.classList.remove('active'));
            }
            
            function clearHighlights() {
                // æ¸…é™¤èœå•é«˜äº®
                const menuItems = $.treeView.querySelectorAll('.folder, .file');
                menuItems.forEach(item => {
                    item.classList.remove('search-hit');
                    
                    // é‡ç½®é«˜äº®è§†å›¾çš„HTML
                    const normalView = item.querySelector('.normal-view');
                    const highlightView = item.querySelector('.highlight-view');
                    if (normalView && highlightView) {
                        highlightView.innerHTML = normalView.innerHTML;
                    }
                });
                
                // æ¸…é™¤å†…å®¹é«˜äº® - æ¢å¤åŸå§‹å†…å®¹
                const area = document.querySelector('.markdown-content');
                if (area && cache.originalContent) {
                    area.innerHTML = cache.originalContent.innerHTML;
                }
                
                // ç§»é™¤æœç´¢æ¨¡å¼
                $.treeView.classList.remove('search-mode');
                $.searchNoResult.style.display = 'none';
                cache.searchMatches = [];
            }
            
            // æœç´¢ç­–ç•¥æ˜ å°„
            const searchStrategies = {
                menu: async (val) => {
                    if (!fullTree) await buildFullTree();
                    
                    // åº”ç”¨åŒIDé«˜äº®æ–¹æ¡ˆ
                    $.treeView.classList.add('search-mode');
                    
                    applySearchHighlight(val);
                    
                    // ä¿å­˜å½“å‰æœç´¢çŠ¶æ€
                    cache.currentSearch.keyword = val;
                    cache.currentSearch.type = 'menu';
                    cache.currentSearch.lastKeyword = val;
                    cache.currentSearch.lastType = 'menu';
                },
                content: async (val) => {
                    // é‡ç½®æœç´¢å–æ¶ˆæ ‡å¿—
                    cache.searchCanceled = false;
                    
                    const found = await searchContent(val);
                    
                    // æ›´æ–°çŠ¶æ€
                    cache.hasSearchResult = found;
                    
                    // æ˜¾ç¤º/éšè—æ— ç»“æœæç¤º
                    $.searchNoResult.style.display = found ? 'none' : 'block';
                    $.searchNoResult.textContent = found ? '' : 'æ— æ­¤æœç´¢é¡¹';
                    
                    // ä¿å­˜å½“å‰æœç´¢çŠ¶æ€
                    cache.currentSearch.keyword = val;
                    cache.currentSearch.type = 'content';
                    cache.currentSearch.lastKeyword = val;
                    cache.currentSearch.lastType = 'content';
                }
            };
            
            // æœç´¢é€»è¾‘å°è£…
            async function searchHandler() {
                const val = $.searchInput.value.trim();
                
                // æ˜¾ç¤ºæ¸…é™¤æŒ‰é’®
                $.searchClear.style.visibility = val ? 'visible' : 'hidden';
                
                // å±•å¼€ä¾§è¾¹æ ï¼ˆå¦‚æœéœ€è¦ï¼‰
                expandSidebarIfNeeded();
                
                if (!val) {
                    clearHighlights();
                    cache.hasSearchResult = false;
                    cache.currentSearch.keyword = '';
                    $.searchNoResult.style.display = 'none';
                    
                    // é‡ç½®æœ€åæœç´¢è®°å½•
                    cache.currentSearch.lastKeyword = '';
                    cache.currentSearch.lastType = '';
                    return;
                }
                
                // é¿å…é‡å¤æœç´¢ç›¸åŒå†…å®¹ï¼ˆä½†å…è®¸ç©ºåˆ°éç©ºçš„æœç´¢ï¼‰
                if (cache.currentSearch.lastKeyword === val && 
                    cache.currentSearch.lastType === searchMode && 
                    cache.hasSearchResult) {
                    return;
                }
                
                // ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¤„ç†ä¸åŒæœç´¢ç±»å‹
                await searchStrategies[searchMode]?.(val);
            }
            
            // ä¸­æ–‡è¾“å…¥æ³•å¤„ç†
            $.searchInput.addEventListener('compositionstart', () => {
                cache.isComposing = true;
            });
            
            $.searchInput.addEventListener('compositionend', () => {
                cache.isComposing = false;
                // ç»„åˆè¾“å…¥ç»“æŸåæ‰§è¡Œä¸€æ¬¡æœç´¢
                searchHandler();
            });
            
            // æœç´¢è¾“å…¥äº‹ä»¶ï¼ˆæ·»åŠ é˜²æŠ–ï¼‰
            const debouncedSearchHandler = debounce(searchHandler, 300);
            $.searchInput.addEventListener('input', function() {
                // å¦‚æœæ˜¯ä¸­æ–‡è¾“å…¥æ³•ç»„åˆçŠ¶æ€ï¼Œä¸æ‰§è¡Œæœç´¢
                if (cache.isComposing) return;
                
                // å½“è¾“å…¥å®Œå…¨æ¸…ç©ºæ—¶å®Œå…¨é‡ç½®çŠ¶æ€
                if (this.value === '') {
                    clearSearch();
                    return;
                }
                
                clearHighlights();
                debouncedSearchHandler();
            });
            
            // æŒ‰ä¸‹Enteré”®è§¦å‘æœç´¢
            $.searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    // å¦‚æœæ˜¯ä¸­æ–‡è¾“å…¥æ³•ç»„åˆçŠ¶æ€ï¼Œä¸æ‰§è¡Œæœç´¢
                    if (cache.isComposing) return;
                    
                    searchHandler();
                    if (window.innerWidth <= 992) {
                        this.blur();
                    }
                }
            });
            
            // æ¸…é™¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            $.searchClear.addEventListener('click', function() {
                clearSearch();
            });
            
            // æŠ˜å æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶å¤¹
            function closeUnrelatedFolders(currentPath) {
                const pathSegments = currentPath.split('/');
                const ancestorPaths = [];
                let tempPath = '';
                for (let i = 0; i < pathSegments.length; i++) {
                    tempPath = tempPath ? tempPath + '/' + pathSegments[i] : pathSegments[i];
                    ancestorPaths.push(tempPath);
                }
                
                document.querySelectorAll('.folder.expanded').forEach(folder => {
                    const folderPath = folder.dataset.path;
                    if (!ancestorPaths.includes(folderPath)) {
                        folder.classList.remove('expanded');
                        const childrenContainer = folder.parentElement.querySelector('.children');
                        if (childrenContainer) {
                            childrenContainer.style.display = 'none';
                        }
                    }
                });
            }
            
$.treeView.onclick = async e => {
    let f = e.target.closest('.folder'), file = e.target.closest('.file');
    if (f && window.innerWidth <= 992 && $.sidebar.classList.contains('collapsed')) {
        expandSidebarIfNeeded();
    }
    if ($.searchNoResult.style.display === 'block') {
        clearSearch();
    }
    if (f) {
        const currentPath = f.dataset.path;
        closeUnrelatedFolders(currentPath);
        let ch = f.parentElement.querySelector('.children');
        const isExpanding = !f.classList.contains('expanded');
        f.classList.toggle('expanded', isExpanding);
        if (isExpanding) {
            if (ch.children.length === 0) {
                // æ‡’åŠ è½½å­ç›®å½•
                const data = await loadVxJson(currentPath);
                (data.folders || []).forEach(subf => {
                    ch.appendChild(createNodeElem(true, subf, currentPath));
                });
                (data.files || []).forEach(subf => {
                    ch.appendChild(createNodeElem(false, subf, currentPath));
                });
            }
            ch.style.display = 'block';
        } else {
            ch.style.display = 'none';
        }
    } else if (file) {
        if (cache.currentFile === file) {
            return;
        }
        document.querySelectorAll('.file.active').forEach(el => el.classList.remove('active'));
        file.classList.add('active');
        cache.currentFile = file;
        await showMd(file.dataset.path); // ä¸ä¼ ç¬¬äºŒä¸ªå‚æ•°
    }
};
            
            $.toggleSidebar.onclick = toggleSidebar;
            
            // æœç´¢ç±»å‹åˆ‡æ¢ä¸åˆ†æµé€»è¾‘
            let searchMode = 'menu';
            $.searchType.addEventListener('click', e => {
                $.searchTypeDropdown.style.display = $.searchTypeDropdown.style.display === 'block' ? 'none' : 'block';
                e.stopPropagation();
            });
            document.addEventListener('click', () => {
                $.searchTypeDropdown.style.display = 'none';
            });
            $.searchTypeDropdown.querySelectorAll('div').forEach(opt => {
                opt.addEventListener('click', e => {
                    searchMode = opt.getAttribute('data-type');
                    if (searchMode === 'menu') {
                        $.searchTypeLabel.textContent = 'èœå•';
                        $.searchInput.placeholder = 'æœç´¢èœå•æ–‡æ¡£...';
                        clearHighlights();
                    } else {
                        $.searchTypeLabel.textContent = 'å†…å®¹';
                        $.searchInput.placeholder = 'æœç´¢å½“å‰å†…å®¹...';
                        clearHighlights();
                    }
                    $.searchTypeDropdown.style.display = 'none';
                    e.stopPropagation();
                    cache.currentSearch.type = searchMode;
                    if ($.searchInput.value) searchHandler();
                    if (window.innerWidth <= 992) {
                        $.searchInput.blur();
                    } else {
                        $.searchInput.focus();
                    }
                });
            });
            
            // è¿”å›é¦–é¡µåŠŸèƒ½
            function returnToHome() {
                // æ¸…é™¤æœç´¢
                clearSearch();
                
                // æŠ˜å æ‰€æœ‰èœå•èŠ‚ç‚¹
                collapseAllFolders();
                
                // æ¸…é™¤å½“å‰æ–‡ä»¶é€‰æ‹©
                if (cache.currentFile) {
                    cache.currentFile.classList.remove('active', 'expanded');
                    const pch = cache.currentFile.nextElementSibling;
                    if (pch && pch.classList.contains('children')) {
                        pch.style.display = 'none';
                    }
                    cache.currentFile = null;
                }
                
                // æ˜¾ç¤ºæ¬¢è¿å†…å®¹
                $.content.innerHTML = '';
                const welcomeClone = $.welcomeContent.cloneNode(true);
                $.content.appendChild(welcomeClone);
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
            
            // æ·»åŠ è¿”å›é¦–é¡µäº‹ä»¶ç›‘å¬
            $.homeLink.addEventListener('click', e => {
                e.preventDefault();
                returnToHome();
            });
            
            // åˆå§‹åŒ–å‡½æ•°
            async function initApp() {
                cache.initialContentHTML = $.content.innerHTML;
                
                try {
                    await buildFullTree();
                    if (fullTree) {
                        renderTree(fullTree);
                    }
                } catch (error) {
                    // é™é»˜å¤±è´¥
                }
            }
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            // äº‹ä»¶ç›‘å¬å’Œåˆå§‹åŒ–
            window.addEventListener('resize', () => {
                if (window.innerWidth > 992) {
                    $.sidebar.classList.remove('collapsed');
                    const icon = $.toggleSidebar.querySelector('.emoji-icon');
                    if (icon) icon.textContent = 'â–½';
                    $.toggleSidebar.setAttribute('data-collapsed', false);
                }
            });
            initApp();
        })();
    </script>
</body>
</html>